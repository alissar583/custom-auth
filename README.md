# Laravel Project Readme

## Introduction

This Laravel project is a simple application that manages users and their posts. It includes a custom authentication guard named `api` with a driver `custom-token`, various custom functionalities, and policies for enhanced security and operations.

## Features

- **Custom Guard:** Uses a custom guard named `api` with the driver `custom-token`.
- **Custom Token Handling:** Tokens are decoded and user IDs are retrieved via `viaRequest` in the `AuthServiceProvider`.
- **Exception Handling:** Implements a custom exception handler for token-related issues.
- **Token Generation:** Tokens are generated by the `generateToken` function in the `GenerateToken` trait used by the `User` model.
- **Middleware:** Custom middleware `EnsureTokenIsValid` registered as `auth.custom` to check user existence in the custom API guard.
- **Policies:** Policies for the `Post` model to ensure only creators can view their posts.
- **Custom Function:** `changeStatus` function to allow request passage only if the post status is `pending`.
- **Resources:** API resources for `User` and `Post`.
- **Custom Command:** `project:setup` command to run migrations, seed the database, and start the project.

## Installation and Setup

1. **Clone the Repository:**
   ```sh
   git clone https://github.com/alissar583/custom-auth.git
   cd custom-auth

2. **Install Dependencies:**
   ```sh
   composer install
   
3. **Environment Configuration:**
   ```sh
   cp .env.example .env
   php artisan key:generate

4. **Run the Custom Setup Command:**
   ```sh
   php artisan project:setup

## Custom Implementations
- **Custom Guard and Token Handling:**

- Custom Guard: Implemented as api using custom-token driver.
- AuthServiceProvider: Registers the custom guard via viaRequest to decode tokens and retrieve user IDs.
- GenerateToken Trait: Used in the User model to generate tokens.

- **Middleware:**
- EnsureTokenIsValid: Middleware registered as auth.custom to ensure the user exists in the custom API guard.

- **Policies:**
- Post Policy: Ensures only the creator of a post can view it.
- Custom Function changeStatus: Allows request passage only if the post status is pending.

- **Resources:**
- UserResource: Handles the transformation of User data for API responses.
- PostResource: Handles the transformation of Post data for API responses.

- **Postman collection:**
- https://documenter.getpostman.com/view/18433697/2sA3e49oUB
